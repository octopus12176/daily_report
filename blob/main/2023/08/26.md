## 2023/8/26（土）

## 取り組んだ課題

- タイピング練習
- 入門 Docker を読む
- Docker のチュートリアルをやる
- クィックスタート: Compose と Rails

## わかったこと

- 入門 Docker を読む
  - Docker は任意のタイミングの状態（ライブラリ・ランタイム・コード）を 1 つのスナップショットとして保存する
  - 仮想化レイヤーが少なく、VM と比較して少ないオーバーヘッドで環境を実現することができる
  - VM は コンピュータ自体 を仮想化するのに対し。Docker はプロセス の仮想化を行う。Docker はホスト OS とリソースを共有し、効率的にホスト OS のリソースを使用することができるため、高速かつ軽量な仮想化を実現している
  - Image は "環境のスナップショット"
  - docker search {LANGUAGE} でパブリックな Docker Image を探すことができる
  - tag を指定することで特定のバージョン(とレジストリ)を使用することができる
  - Docker Container は 1 つのコマンドをフォアグラウンドで動かすように設計されている
  - Docker Container は大きく 5 つの状態を遷移する
    - **Image**は、指定した Docker Image から Docker Container を起動する
    - **RUNNING**は、Docker Container が起動した状態
    - **PAUSED**は、Container が停止した状態
    - **DELETED**は、削除された状態。Docker Container は明示的に削除を行わない限り停止した状態で残り続ける
  - ネットワーク
    - 1 プロセス 1 コンテナ、複数プロセスはネットワークを通して通信を行う
    - Bridge を基本的に使用する
  - ボリューム
    - データの永続化に Volume を使用する
    - コンテナ間で Volume の共有は可能
    - Docker はエフェメラルになるような設計を求められるため、基本的に Volume は使用しないことが好ましい
  - セキュリティ
    - root ユーザを使わない
      - USER コマンド使用してユーザーを変更したほうが無難
    - 野良の Docker イメージをベースイメージにしない
      - 基本的にベースイメージは公式のものを使用するようにする
    - ビルド時に機微情報を与えない
      - ビルド時に機微情報を与えないようにする
      - パスワードや接続情報などは環境変数や Vault などへ格納する
    - ホストのファイルのマウントの仕方
      - 最小限の権限とパスで範囲を狭くするようにする
      - 特に注意が必要なのは docker ソケットで、安易に与えるのは控え、ソケットをマウントしなければならない場合は Read-Only でマウントするようにする
    - .dockerignore ファイルを使う
      - .env のような DB への接続情報や SaaS のアクセスキーが記載されているファイルをビルドに含める
      - 他にも .git や node_modules のようなビルド時に不要なパスは無視することでビルドが高速かつイメージが軽量になるので良い
  - Dockerfile のベストプラクティス
    - 軽量なイメージを作る
      - a
    - 最小限の構成にする
      - Docker はいままでの VM とは思想が異なるため、1 コンテナ 1 プロセスになるように設計を行う
      - 複数のプロセスを使用したい場合はそれぞれコンテナに分け、オーケストレーションツールを使用してコンテナを協調させて動かす
    - 軽量なベースイメージを使用する
    - .dockerignore を使う
    - キャッシュを意識する
    - Multi-Stage Build
      - Multi-Stage Build は複数の Docker Image を作り、最終的にその複数の Docker Image から任意のファイルだけを抽出して 1 つの Docker Image にする
  - オーケストレーションツール
    - 複数の Docker を動かすためツール
    - 主に Docker の管理/自動復旧・ネットワークの管理・オートスケールなど、本番のワークロードに必要な機能を備えている
      - 代表的なオーケストレーションツール
        - docker-compose
        - swarm
          - docker-compose と同様に Docker 社がホストするオーケストレーションツール
          - docker-compose と相性がよく、 docker-compose.yaml を拡張することで本番のワークロードで Docker を使用することができる
        - ECS (Elastic Container Service)
          - AWS が開発したオーケストレーションツール
          - AWS が開発したということで、他の AWS サービスと連携が行いやすい
          - 他のオーケストレーションツールと比較して責任を持つ範囲が狭いため、比較的学習コストが低い
        - Kubernetes
          - Google 社が開発した OSS のオーケストレーションツール
          - Kubernetes が現在のデファクトスタンダード
          - 自由度が高く豊富なエコシステムがあり、コミュニティも非常に活発
- Docker のチュートリアルをやる
  - 「docker logs { コンテナ ID }」でコンテナのログを確認することができる
- クィックスタート: Compose と Rails
  - rails と postgres を使用した Docker 環境の構築
- 「docker で開発環境を構築する」課題
  - 「rake db:create」は database.yml の内容でデータベースを作成するコマンド

## 感じたこと

- 入門 Docker を読む
- Docker のチュートリアルをやる
- クィックスタート: Compose と Rails
- 「docker で開発環境を構築する」課題
  - Docker のインプットからアウトプットの課題まで一通り完了した。これらを通して Docker の基本は身についたが、まだまだ奥が深い領域なので引き続き勉強をしていきたい。

## 次やること

- docker で開発環境を構築する課題

## 勉強時間

- Today: 6.0h
- Total: 212.5h
