## 2024/2/27（火）

## 取り組んだ課題

- タイピング練習
- Software Design 2023年9月号：JavaScript非同期処理の疑問を解き明かす

## わかったこと
- Software Design 2023年9月号：JavaScript非同期処理の疑問を解き明かす
  - イベントループの共通動作
    - JavaScriptコードはタスクかマイクロタスクかのいずれかとして処理される。イベントループは各種キューにタスクとマイクロタスクを配置したうえでルールに沿って順番に処理を行うループの機構。
      - マイクロタスクはPromise処理のために追加された新しい機構。fetchといったモダンな非同期APIはPromiseを返し、そのオブジェクトにチェーンしたthenメソッドのコールバック関数はマイクロタスクとして処理される。
      - タスクは古くからある機構で、クリックといったUIイベントのコールバック関数やsetTimeoutといった非同期APIのコールバック関数はタスクとして処理される。
      - タスクやマイクロタスクがイベントループ上で連鎖的に処理されることで非同期APIを起点にした一連の関連作業が逐次的に処理される。これがJavaScriptのシングルスレッドで非同期処理を成立されるメカニズムであり、実行順序を予測するためのメンタルモデルにもなる。
      - タスクとマイクロタスクはそれぞれタスクキューとマイクロタスクキューと呼ばれるキューに挿入されて管理される。マイクロタスクのほうがタスクよりも優先的に処理されるルールがあり、複数の実行環境においてもイベントループの共通動作として次の事柄が期待される。
        - 単一のタスクが処理されたら次に全てのマイクロタスクが処理される。
          - マイクロタスクキューは基本的に1つだが、タスクキューは複数あり得ることに注意。タスクの種類（≒APIの種類）によってどのタスクキューにどのタスクが入れられるかが決まっており、イベントループでは複数のタスクキューからまず1つのタスクキューが選択されたうえでそのキューの戦闘にあるタスクが処理される。このときどのタスクキューを選ぶかは環境側が独自に決定する。例えば、Chrome環境ではBlinkといったレンダリングエンジンがタスクキューに対して優先度を振っており、どのタスクキューを選択するかを決定しており、基本的にプログラマー側からはこの決定は操作できない。
          - 単一タスクが処理されたあとにマイクロタスクキューがチェックされて、そのキュー内にある全てのマイクロタスクが戦闘から順番に処理されていく。マイクロタスクキューが空になったら次のタスクが処理されることになるが、ブラウザ環境ならこの段階にレンダリング更新作業が定期的に挟まれる。つまり、長い時間のかかるタスクがあると、このレンダリング更新作業ができずにフレームが落ちることになる。

## 次やること
- Software Design 2023年9月号：JavaScript非同期処理の疑問を解き明かす

## 勉強時間

- Today: 1.0h
- Total: 717.0h
